<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stock Details</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Serif+4:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <h1>
        Stock Financial Analysis: <span id="stock-symbol-header">SYMBOL</span>
      </h1>
    </header>

    <main>
      <!-- Legend for median comparison -->
      <div class="comparison-legend">
        <strong>Legend:</strong>
        <div class="legend-item">
          <span class="legend-icon better">▲</span>
          <span>Above median (better)</span>
        </div>
        <div class="legend-item">
          <span class="legend-icon worse">▼</span>
          <span>Below median (worse)</span>
        </div>
        <div class="legend-item">
          <span class="legend-icon equal">▬</span>
          <span>At median</span>
        </div>
      </div>

      <!-- Section Navigation Pills (Sticky on mobile) -->
      <nav class="section-nav">
        <div class="section-nav-scroll">
          <a href="#balance-sheet-strength" class="section-pill active">
            Balance Sheet
          </a>
          <a href="#profitability" class="section-pill"> Profitability </a>
          <a href="#valuation" class="section-pill"> Valuation </a>
          <a href="#growth" class="section-pill"> Growth </a>
        </div>
      </nav>

      <section id="balance-sheet-strength" class="financial-section">
        <h2>Balance Sheet Strength</h2>
        <div class="metrics-container">
          <div class="metric">
            <span class="metric-label"
              >Tangible Equity / Total Liabilities:</span
            >
            <span id="tang_equity_over_tot_liab" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="tang_equity_over_tot_liab_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Capital Intensity (Reversed):</span>
            <span id="capital_intensity_reverse" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="capital_intensity_reverse_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label"
              >CAGR 5Y Tangible Book Value Per Share:</span
            >
            <span id="cagr_tangible_book_per_share" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="cagr_tangible_book_per_share_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">CAGR 5Y Cash and Equivalent:</span>
            <span id="cagr_cash_and_equiv" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span id="cagr_cash_and_equiv_median" class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
        </div>
      </section>

      <section id="profitability" class="financial-section">
        <h2>Profitability</h2>
        <div class="metrics-container">
          <div class="metric">
            <span class="metric-label">ROE (Tangible Equity):</span>
            <span id="roe_tangible_equity" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span id="roe_tangible_equity_median" class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">ROIC / WACC:</span>
            <span id="roic_over_wacc" class="metric-value">Loading...</span>
            <span class="metric-median-container">
              (Median:
              <span id="roic_over_wacc_median" class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Rule of 40:</span>
            <span id="rule_of_40" class="metric-value">Loading...</span>
            <span class="metric-median-container">
              (Median:
              <span id="rule_of_40_median" class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Cash Conversion Ratio:</span>
            <span id="cash_conversion_ratio" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="cash_conversion_ratio_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Avg. 5 Years ROE Growth:</span>
            <span id="avg_5years_roe_growth" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="avg_5years_roe_growth_median"
                class="metric-value-median"
                >Loading...</span
              >
              )
            </span>
          </div>
        </div>
      </section>

      <section id="valuation" class="financial-section">
        <h2>Valuation</h2>
        <div class="metrics-container">
          <div class="metric">
            <span class="metric-label">Earnings Yield:</span>
            <span id="earnings_yield" class="metric-value">Loading...</span>
            <span class="metric-median-container">
              (Median:
              <span id="earnings_yield_median" class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Price to Earnings (P/E):</span>
            <span id="price_to_earnings" class="metric-value">Loading...</span>
            <span class="metric-median-container">
              (Median:
              <span id="price_to_earnings_median" class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">FCF Yield:</span>
            <span id="fcf_yield" class="metric-value">Loading...</span>
            <span class="metric-median-container">
              (Median:
              <span id="fcf_yield_median" class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">PEG Ratio:</span>
            <span id="peg" class="metric-value">Loading...</span>
            <span class="metric-median-container">
              (Median:
              <span id="peg_median" class="metric-value-median">Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Price to Tangible Book Value:</span>
            <span id="price_to_tangible_book" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="price_to_tangible_book_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
        </div>
      </section>

      <section id="growth" class="financial-section">
        <h2>Growth</h2>
        <div class="metrics-container">
          <div class="metric">
            <span class="metric-label">Avg. 5 Years EPS Growth:</span>
            <span id="avg_5years_eps_growth" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="avg_5years_eps_growth_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Avg. 5 Years Revenue Growth:</span>
            <span id="avg_5years_revenue_growth" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="avg_5years_revenue_growth_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Expected Growth Market Cap (10Y):</span>
            <span id="expected_growth_market_cap_10Y" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="expected_growth_market_cap_10Y_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Final Earnings (10Y Growth @ 10%):</span>
            <span id="final_earnings_for_10y_growth_10perc" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="final_earnings_for_10y_growth_10perc_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Final Earnings (10Y Growth @ 15%):</span>
            <span id="final_earnings_for_10y_growth_15perc" class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="final_earnings_for_10y_growth_15perc_median"
                class="metric-value-median"
                >Loading...</span
              >)</span
            >
          </div>
          <div class="metric">
            <span class="metric-label"
              >Implied Perpetual Growth (Current Market Cap):</span
            >
            <span
              id="implied_perpetual_growth_curr_market_cap"
              class="metric-value"
              >Loading...</span
            >
            <span class="metric-median-container">
              (Median:
              <span
                id="implied_perpetual_growth_curr_market_cap_median"
                class="metric-value-median"
                >Loading...</span
              >)
            </span>
          </div>
        </div>
      </section>

      <div class="navigation-links">
        <a href="index.html">Back to Main Page</a>
      </div>
    </main>

    <footer>
      <p>&copy; <span id="current-year"></span> Financial Portfolio Analysis</p>
    </footer>

    <script src="js/xlsx.full.min.js"></script>
    <script src="js/stock_details_page.js"></script>
    <script>
      // Set the current year in the footer
      document.getElementById("current-year").textContent =
        new Date().getFullYear();

      // Section navigation highlighting
      document.addEventListener("DOMContentLoaded", function () {
        const pills = document.querySelectorAll(".section-pill");
        const sections = document.querySelectorAll(".financial-section");

        // Update active pill on click
        pills.forEach((pill) => {
          pill.addEventListener("click", function (e) {
            pills.forEach((p) => p.classList.remove("active"));
            this.classList.add("active");
          });
        });

        // Function to update active pill based on scroll position
        function updateActivePill() {
          const scrollPosition = window.scrollY + 150; // Offset for sticky nav
          const windowHeight = window.innerHeight;
          const documentHeight = document.documentElement.scrollHeight;

          // If we're at the bottom of the page, activate the last section
          if (windowHeight + window.scrollY >= documentHeight - 50) {
            pills.forEach((pill) => pill.classList.remove("active"));
            const lastPill = pills[pills.length - 1];
            if (lastPill) lastPill.classList.add("active");
            return;
          }

          // Otherwise, find which section is currently in view
          let currentSection = null;
          sections.forEach((section) => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.offsetHeight;

            if (
              scrollPosition >= sectionTop &&
              scrollPosition < sectionTop + sectionHeight
            ) {
              currentSection = section;
            }
          });

          // Update active pill
          if (currentSection) {
            pills.forEach((pill) => {
              pill.classList.remove("active");
              if (pill.getAttribute("href") === `#${currentSection.id}`) {
                pill.classList.add("active");
              }
            });
          }
        }

        // Update on scroll with throttling for performance
        let scrollTimeout;
        window.addEventListener("scroll", function () {
          if (scrollTimeout) {
            window.cancelAnimationFrame(scrollTimeout);
          }
          scrollTimeout = window.requestAnimationFrame(function () {
            updateActivePill();
          });
        });

        // Initial update
        updateActivePill();
      });
    </script>
  </body>
</html>
